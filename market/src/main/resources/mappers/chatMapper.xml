<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

  
<mapper namespace="ChatDAO">
 

  <!-- 채팅목록 조회  -->
  <select id="myChatList" parameterType="chat" resultType="chat">
	<![CDATA[
		select a.chatmember,a.chatroomno,a.user1,a.user2,m.name,m.address,m.profile,cm.chatmessage
		from chatmember a
		Left Join member m
		ON a.user2 = m.memberno
		Left Join (SELECT chatroomno, chatmessage,chatmessageno
        FROM ( SELECT chatroomno, chatmessage,chatmessageno
        , ROW_NUMBER() OVER(PARTITION BY chatroomno ORDER BY chatmessageno DESC) as RowIdx
        FROM chatmessage 
        ) t1 WHERE RowIdx = 1) cm
		ON a.chatroomno = cm.chatroomno
		where user1 = #{user1}
     ]]>
    </select>
    
<!--     <insert id="insertChatMessage" parameterType="chat"> 
        insert into member(email,password,name,gender,phone,address) values(#{email},#{password},#{name},#{gender},#{phone},#{address}) 
    </insert> -->
    
  <!-- 선택된 채팅내용  -->
  <select id="SelectChatList" parameterType="chat" resultType="chat">
	<![CDATA[
		select * from chatmessage where chatroomno = #{chatroomno};
     ]]>
    </select>
 	
</mapper>